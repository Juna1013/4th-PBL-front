---
title: "デジタルツイン解説"
date: "2024-12-25"
description: "現実のライントレースカーと同期する仮想モデルの仕組みと実装"
---

## デジタルツインとは

デジタルツイン（Digital Twin）とは、現実世界にある物理的なオブジェクトやシステムを、デジタル空間上に双子（ツイン）のように再現する技術のことです。
本プロジェクトでは、物理的な8つの赤外線センサーから得られる情報を元に、**ライントレースカーの挙動をWebブラウザ上でリアルタイムに再現**しています。

### システムの目的

1.  **遠隔モニタリング**: 現場にいなくても、マシンがコース上のどこをどのように走行しているかを確認できます。
2.  **デバッグ効率化**: センサーの反応と車体の挙動の関係を視覚的に理解することで、制御アルゴリズムの不具合を早期に発見できます。
3.  **データ可視化**: 単なる数値の羅列ではなく、直感的なアニメーションとしてデータを表現します。

## 社会における導入事例

デジタルツイン技術は、既に様々な産業分野で実用化が進んでいます。

### 🏭 製造業（スマートファクトリー）
工場の生産ラインを仮想空間に再現し、設備の稼働状況をリアルタイムで監視。故障の予兆検知や、ライン構成変更時の生産効率シミュレーションに利用され、ダウンタイムの削減と生産性の向上を実現しています。

### 🏙️ 都市計画（スマートシティ）
交通流、エネルギー消費、人流などのデータを統合し、都市全体をデジタルツイン化。渋滞緩和のための信号制御最適化や、災害時の避難ルートシミュレーションなど、持続可能な都市づくりに活用されています（例：国土交通省 PLATEAU）。

### 🚗 自動車産業（自動運転開発）
実走行でのテストが難しい危険なシナリオや、天候条件（豪雨、濃霧など）を仮想空間で再現し、AI（自動運転システム）の学習と検証を行います。数百万キロメートル相当の走行試験を仮想空間上で行うことで、安全性と開発速度を飛躍的に高めています。
本プロジェクトのライントレースカー・デジタルツインも、この開発プロセスの基礎的な概念を具現化したものです。

## 実装の仕組み

### 1. リアルタイム位置推定

マシンの位置は、8つのセンサー（`sensors`）の値から計算されます。

```typescript
// 重心計算による位置推定の擬似コード
const activeSensors = sensors.map((val, idx) => val === 0 ? idx : -1).filter(idx => idx !== -1);
const centerOfGravity = activeSensors.reduce((a, b) => a + b, 0) / activeSensors.length;

// 中心(3.5)からの偏差
const deviation = centerOfGravity - 3.5;
```

センサーが黒線（値が0）を検知している箇所の「重心位置」を計算することで、マシンがラインの中心からどれだけ左右にズレているか（偏差）を推定しています。

### 2. ヘディングアップ視点 (Heading-Up View)

本システムのダッシュボードでは、ドライバー視点のような「ヘディングアップ」表示を採用しています。

-   **車体**: 常に画面の「上」を向いて固定されています。
-   **コース（ライン）**: センサーの検知状況に応じて、左右に移動・回転します。

これにより、マシンが「今、右にズレているのか、左にズレているのか」が瞬時に判別可能となり、操縦や制御の遅れを視覚的に捉えやすくなります。

### 3. 通信アーキテクチャ

物理マシンとデジタルツインの同期は以下のフローで行われます。

1.  **Raspberry Pi Pico W**: センサー状態をJSON形式でAPIサーバーにPOST送信
2.  **Next.js API**: 受信データをメモリ内のストア（Singleton）に一時保存
3.  **Web Client (SWR)**: 高頻度でAPIをポーリングし、最新の状態を取得してCanvas/SVGを再描画

このサイクルを高速に回すことで、あたかもリアルタイムでつながっているかのようなスムーズなアニメーションを実現しています。

## 今後の展望

現在は2次元（2D）での可視化ですが、将来的にはThree.jsを用いた3Dモデルの表示や、物理演算エンジンを導入したシミュレーション機能（Sim-to-Real）への拡張も計画されています。
また、蓄積された走行ログ（強化学習用データセット）を用いて、過去の走行をリプレイする機能の実装も可能です。
